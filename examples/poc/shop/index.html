<!DOCTYPE html>
<html>

<head>
  <h2 style="color: rgb(135, 129, 211)">Affärsfönster</h2>
  <link rel="stylesheet" type="text/css" href="css.css" />
</head>

<body>
  <form action="/buy" method="POST" id="buyForm">
    <label for="Företag"> Företag </label>
    <br>
    <input name="businessName" value="Tågresor.se" />
    </input>
    <br>
    <label for="organisationsId"> OrganisationsId </label>
    <br>
    <input name="orgId" value="123" />
    </input>
    <h3>
      Köp produkt
    </h3>

    <div style="display: table-cell;">
      <ul>
        <li>
          <label for="date"> Datum </label>
          <label class="time" for="time"> tid </label>
          <br>
          <input name="date" type="date" id="date" value="YYYY-MM-DD" />
          </input>
          <input name="time" type="time" id="time" value="16:48" />
          </input>
        </li>
        <li>
          <label for="ref"> KvittoId </label>
          <br>
          <input name="ref" id="ref">
          </input>
        </li>
        <li>
          <label for="articleName"> Artikelnamn </label>
          <br>
          <input name="articleName" id="articleName" value="Tågbiljett">
          </input>
        </li>
        <li>
          <label for="amount"> Belopp </label>
          <br>
          <input name="amount" id="amount" value="100">
          </input>
        </li>
        <li>
          <label for="tax"> Moms </label>
          <br>
          <input name="tax" id="tax" value="25">
          </input>
        </li>
        <li>
          <label for="currency"> Valuta </label>
          <br>
          <input name="currency" id="currency" value="SEK">
          </input>
        </li>

      </ul>
    </div>
  </form>

  <div id="buy">
    <button onclick="buy()">KÖP</button>
  </div>
  <script type="text/javascript">
    function setId() {
      var ref = document.querySelector(`#ref`);
      ref.value = Date.now();
    }
    setId()

    function setDate() {
      const myDate = document.querySelector(`input[type="date"]`);
      const myTime = document.querySelector(`input[type="time"]`);
      const today = new Date();
      today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
      myDate.value = today.toJSON().substring(0, 10)
      myTime.value = today.toJSON().substring(11, 16)
    }

    setDate()
    async function buy() {
      var form = document.querySelector('form');
      var formData = new FormData(form);
      var req = new XMLHttpRequest();
      req.open('POST', '/buy')
      req.onload = function (e) {
        var code = req.status;
        var text = req.statusText;

        if (code === 200) {
          document.getElementById(
            'buy'
          ).innerHTML = `<div style="color: green; font-size:100px ">&#9989</div>`
          setTimeout(() => {
            document.getElementById(
              'buy'
            ).innerHTML = `<button onclick="buy()">KÖP</button>`
          }, 2500)
        } else {
          alert(req.responseText)
        }
      }
      req.send(formData)
    }
  </script>
</body>

</html>